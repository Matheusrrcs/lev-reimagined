<?php
/**
 * Single Service Template
 *
 * @package Clinica_Levin
 */

get_header();
?>

<?php while (have_posts()) : the_post(); ?>

<!-- Hero Section -->
<section class="hero" style="min-height: 50vh;">
    <div class="container">
        <div class="hero-content">
            <div class="hero-text animate-fadeInUp">
                <span class="hero-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                    Serviço
                </span>
                
                <h1 class="hero-title"><?php the_title(); ?></h1>
                
                <?php if (has_excerpt()) : ?>
                <p class="hero-description"><?php the_excerpt(); ?></p>
                <?php endif; ?>
                
                <div class="hero-buttons">
                    <?php
                    $whatsapp = get_theme_mod('whatsapp_number', '');
                    if ($whatsapp) :
                    ?>
                    <a href="https://wa.me/<?php echo esc_attr($whatsapp); ?>?text=<?php echo urlencode('Olá! Gostaria de agendar uma consulta de ' . get_the_title()); ?>" 
                       class="btn btn-primary btn-lg" 
                       target="_blank" 
                       rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                        Agendar Consulta
                    </a>
                    <?php endif; ?>
                    
                    <a href="<?php echo esc_url(home_url('/servicos')); ?>" class="btn btn-secondary btn-lg">
                        Ver Outros Serviços
                    </a>
                </div>
            </div>
            
            <?php if (has_post_thumbnail()) : ?>
            <div class="hero-image-wrapper animate-fadeInUp delay-200">
                <img src="<?php the_post_thumbnail_url('hero-image'); ?>" alt="<?php the_title_attribute(); ?>" class="hero-image">
            </div>
            <?php endif; ?>
        </div>
    </div>
</section>

<!-- Service Content -->
<section class="section-lg">
    <div class="container" style="max-width: 900px;">
        <div class="about-grid" style="gap: var(--spacing-2xl);">
            <!-- Main Content -->
            <div class="animate-on-scroll" style="grid-column: span 2;">
                <div class="post-content" style="font-size: 1.125rem; line-height: 1.8;">
                    <?php the_content(); ?>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Features -->
<?php
$features = get_post_meta(get_the_ID(), 'service_features', true);
if ($features) :
    $features_array = array_filter(explode("\n", $features));
?>
<section class="about-section section-lg">
    <div class="container">
        <div class="section-header animate-on-scroll">
            <span class="section-badge">O Que Inclui</span>
            <h2 class="section-title">Benefícios do Serviço</h2>
        </div>
        
        <div class="services-grid" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
            <?php foreach ($features_array as $index => $feature) : ?>
            <div class="card animate-on-scroll" style="animation-delay: <?php echo $index * 0.1; ?>s; display: flex; align-items: flex-start; gap: var(--spacing-sm);">
                <div class="service-icon" style="flex-shrink: 0; width: 40px; height: 40px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                </div>
                <p style="margin: 0; font-weight: 500;"><?php echo esc_html(trim($feature)); ?></p>
            </div>
            <?php endforeach; ?>
        </div>
    </div>
</section>
<?php endif; ?>

<!-- How it Works -->
<section class="section-lg">
    <div class="container">
        <div class="section-header animate-on-scroll">
            <span class="section-badge">Processo</span>
            <h2 class="section-title">Como Funciona</h2>
        </div>
        
        <div class="services-grid" style="grid-template-columns: repeat(4, 1fr);">
            <?php
            $steps = array(
                array('number' => '01', 'title' => 'Agendamento', 'description' => 'Entre em contato e escolha o melhor horário'),
                array('number' => '02', 'title' => 'Avaliação', 'description' => 'Consulta inicial para entender suas necessidades'),
                array('number' => '03', 'title' => 'Planejamento', 'description' => 'Criamos um plano personalizado para você'),
                array('number' => '04', 'title' => 'Acompanhamento', 'description' => 'Suporte contínuo para alcançar seus objetivos'),
            );
            
            foreach ($steps as $step) :
            ?>
            <div class="card animate-on-scroll" style="text-align: center;">
                <div style="width: 50px; height: 50px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; margin: 0 auto var(--spacing-md);">
                    <?php echo esc_html($step['number']); ?>
                </div>
                <h3 class="card-title" style="font-size: 1rem;"><?php echo esc_html($step['title']); ?></h3>
                <p class="card-text" style="font-size: 0.875rem;"><?php echo esc_html($step['description']); ?></p>
            </div>
            <?php endforeach; ?>
        </div>
    </div>
</section>

<?php endwhile; ?>

<!-- Other Services -->
<?php
$other_services = new WP_Query(array(
    'post_type'      => 'servico',
    'posts_per_page' => 3,
    'post__not_in'   => array(get_the_ID()),
    'orderby'        => 'rand',
));

if ($other_services->have_posts()) :
?>
<section class="about-section section-lg">
    <div class="container">
        <div class="section-header animate-on-scroll">
            <span class="section-badge">Explore</span>
            <h2 class="section-title">Outros Serviços</h2>
        </div>
        
        <div class="services-grid">
            <?php while ($other_services->have_posts()) : $other_services->the_post(); ?>
            <article class="service-card animate-on-scroll">
                <?php if (has_post_thumbnail()) : ?>
                <img src="<?php the_post_thumbnail_url('service-card'); ?>" alt="<?php the_title_attribute(); ?>" class="service-image">
                <?php endif; ?>
                
                <div class="service-content">
                    <h3 class="service-title"><?php the_title(); ?></h3>
                    <p class="service-description"><?php echo wp_trim_words(get_the_excerpt(), 15); ?></p>
                    <a href="<?php the_permalink(); ?>" class="btn btn-outline">
                        Saiba Mais
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                    </a>
                </div>
            </article>
            <?php endwhile; wp_reset_postdata(); ?>
        </div>
    </div>
</section>
<?php endif; ?>

<!-- CTA -->
<section class="cta-section section-lg">
    <div class="container">
        <div class="cta-content animate-on-scroll">
            <h2 class="cta-title">Pronto para Começar?</h2>
            <p class="cta-description">
                Agende sua consulta agora e dê o primeiro passo para uma vida mais saudável.
            </p>
            <div class="cta-buttons">
                <?php
                $whatsapp = get_theme_mod('whatsapp_number', '');
                if ($whatsapp) :
                ?>
                <a href="https://wa.me/<?php echo esc_attr($whatsapp); ?>?text=<?php echo urlencode('Olá! Gostaria de agendar uma consulta.'); ?>" 
                   class="btn btn-white btn-lg" 
                   target="_blank" 
                   rel="noopener noreferrer">
                    Agendar via WhatsApp
                </a>
                <?php endif; ?>
            </div>
        </div>
    </div>
</section>

<?php get_footer(); ?>
